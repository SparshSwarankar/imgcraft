{% extends "base.html" %}

{# --- ENHANCED SEO BLOCKS START --- #}
{% block title %}AI Image Annotation & Tagging Tool - Professional Metadata Editor | ImgCraft{% endblock %}

{% block meta_description %}Professional image annotation tool with AI-powered tagging. Draw bounding boxes, create
polygons, add labels and metadata. Export annotations as JSON for machine learning, computer vision, and dataset
creation. Perfect for AI training, object detection, image classification, and professional photography workflows.{%
endblock %}

{% block meta_keywords %}image annotation tool, ai annotation, bounding box tool, image tagging software, metadata
editor, polygon annotation, object detection annotation, computer vision tool, dataset annotation, image labeling, ml
annotation tool, ai training data, annotation export json, professional image tagger, visual annotation, image markup
tool, photo metadata editor, annotation software online, machine learning annotation, object tagging tool, ai dataset
creator, image classification tool, annotation platform, visual tagging system, imgcraft annotation{% endblock %}

{% block og_title %}AI Image Annotation & Tagging Tool - Professional Metadata Editor | ImgCraft{% endblock %}

{% block og_description %}Create professional image annotations with bounding boxes, polygons, and custom tags. Export
to JSON for AI/ML workflows. Advanced metadata management for computer vision projects.{% endblock %}
{# --- ENHANCED SEO BLOCKS END --- #}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/annotation.css') }}">

<!-- Fabric.js for Canvas Manipulation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

<!-- FileSaver.js for Exporting JSON -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
{% endblock %}

{% block content %}
<div class="studio-wrapper">

    <aside class="studio-panel studio-panel-left glass-panel">
        <div class="panel-header">
            <h3><i class="fas fa-pencil-alt"></i> Tools</h3>
            <div class="badge badge-premium"><i class="fas fa-crown"></i> PRO</div>
        </div>

        <div class="panel-content custom-scrollbar">

            <div id="fileInfoSection" style="display: none;">
                <div class="file-info-section">
                    <div class="file-info-row">
                        <span class="file-info-label">Name:</span>
                        <span class="file-info-value" id="fileName">-</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Size:</span>
                        <span class="file-info-value" id="fileSize">-</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Dim:</span>
                        <span class="file-info-value" id="fileDimensions">-</span>
                    </div>
                </div>

                <hr class="panel-divider">

                <div class="control-section">
                    <label class="section-label">Annotation Mode</label>
                    <div class="tool-grid-2x2">
                        <button class="tool-card active" id="selectTool" title="Select/Edit Mode (V)">
                            <i class="fas fa-mouse-pointer"></i>
                            <span>Select</span>
                        </button>
                        <button class="tool-card" id="rectTool" title="Rectangle Mode (R)">
                            <i class="far fa-square"></i>
                            <span>Box</span>
                        </button>
                        <button class="tool-card" id="polygonTool" title="Polygon Mode (P)">
                            <i class="fas fa-draw-polygon"></i>
                            <span>Poly</span>
                        </button>
                        <button class="tool-card" id="pointTool" title="Point Mode (M)">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Point</span>
                        </button>
                    </div>
                </div>

                <hr class="panel-divider">

                <div id="activeProps" style="display: none;">
                    <label class="section-label">Selected Item</label>
                    <div class="properties-box">
                        <div class="input-group mb-2">
                            <label>Label / Class</label>
                            <input type="text" id="activeLabel" class="dark-input" placeholder="e.g. Car, Person">
                        </div>
                        <div class="input-group mb-2">
                            <label>Color Tag</label>
                            <div class="color-picker-wrapper">
                                <input type="color" id="activeColor" value="#F97316">
                                <span id="colorHex">#F97316</span>
                            </div>
                        </div>
                        <button class="btn btn-danger btn-sm w-100" id="deleteActiveBtn">
                            <i class="fas fa-trash"></i> Delete Selected
                        </button>
                    </div>
                </div>

                <div class="info-card-small mt-3">
                    <i class="fas fa-keyboard" style="color: var(--primary);"></i>
                    <p><strong>Shortcuts:</strong><br><b>Del</b> to remove<br><b>Ctrl+Z</b> to Undo</p>
                </div>
            </div>

            <div class="info-box-empty" id="startInfoLeft">
                <i class="fas fa-draw-polygon"></i>
                <p>Upload image to start annotating</p>
            </div>
        </div>
    </aside>


    <main class="studio-canvas">
        <div class="canvas-container">

            <div class="upload-area-large" id="dropZone">
                <div class="upload-content">
                    <div class="upload-icon-large floating-anim"><i class="fas fa-tag"></i></div>
                    <h2>AI Annotation Studio</h2>
                    <p class="text-muted">Drag & drop JPG, PNG for labeling</p>
                    <p class="text-muted" style="font-size: 0.85rem; margin-top: 8px;"><i class="fas fa-info-circle"></i> Upload free â€¢ 15 credits per export</p>
                    <button class="btn btn-primary mt-4" onclick="document.getElementById('fileInput').click()">
                        Browse Files
                    </button>
                    <input type="file" id="fileInput" hidden accept="image/*">
                </div>
            </div>

            <div class="preview-stage" id="editorStage" style="display: none;">
                <div class="annotation-wrapper" id="canvasWrapper">
                    <canvas id="c"></canvas>
                </div>

                <div class="canvas-floating-controls">
                    <button class="float-btn" id="zoomOutBtn" title="Zoom Out"><i class="fas fa-minus"></i></button>
                    <span class="zoom-text" id="zoomLevel">100%</span>
                    <button class="float-btn" id="zoomInBtn" title="Zoom In"><i class="fas fa-plus"></i></button>
                    <div class="divider"></div>
                    <button class="float-btn" id="panTool" title="Pan Canvas (Space)"><i
                            class="fas fa-hand-paper"></i></button>
                    <button class="float-btn" id="resetViewBtn" title="Fit to Screen"><i
                            class="fas fa-compress"></i></button>
                </div>
            </div>

        </div>
    </main>


    <aside class="studio-panel studio-panel-right glass-panel">
        <div class="panel-header">
            <h3><i class="fas fa-layer-group"></i> Data</h3>
            <span class="badge-count" id="objectCount">0 Objects</span>
        </div>

        <div class="panel-content custom-scrollbar">

            <div id="dataSection" style="display: none;">

                <div class="control-section">
                    <label class="section-label collapsible" onclick="toggleMeta()">Global Metadata <i
                            class="fas fa-chevron-down"></i></label>
                    <div id="metaForm" class="meta-form">
                        <input type="text" id="metaTitle" class="dark-input mb-2" placeholder="Image Title">
                        <input type="text" id="metaTags" class="dark-input" placeholder="Tags (comma separated)">
                    </div>
                </div>

                <hr class="panel-divider">

                <div class="control-section" style="flex: 1; display: flex; flex-direction: column;">
                    <label class="section-label">Objects List</label>
                    <div class="annotations-list-container custom-scrollbar" id="annotationsList">
                    </div>
                    <div id="emptyListMsg" class="text-muted text-center mt-4 text-sm">
                        No annotations yet.
                    </div>
                </div>

            </div>

            <div class="info-box-empty" id="startInfoRight">
                <i class="fas fa-code"></i>
                <p>Output data will appear here</p>
            </div>

        </div>

        <div class="panel-footer">
            <div id="exportActions" style="display: none;">
                <div class="btn-group-vertical">
                    <button class="btn btn-primary btn-full" id="exportJsonBtn">
                        <i class="fas fa-file-code"></i> Export JSON <span style="opacity: 0.8; font-size: 0.85em;">(15 credits)</span>
                    </button>
                    <button class="btn btn-outline btn-full mt-2" id="exportImageBtn">
                        <i class="fas fa-image"></i> Export Image <span style="opacity: 0.8; font-size: 0.85em;">(15 credits)</span>
                    </button>
                </div>
                <div class="text-center mt-3">
                    <button class="btn-link-danger" id="clearAllBtn">Clear All</button>
                </div>
            </div>

            <button class="btn btn-primary btn-full" disabled id="dummyExportBtn">Export Data</button>
        </div>
    </aside>

</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/annotation.js') }}"></script>
{% endblock %}